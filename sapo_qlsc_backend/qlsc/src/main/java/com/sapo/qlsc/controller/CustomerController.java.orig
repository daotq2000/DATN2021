package com.sapo.qlsc.controller;

import com.sapo.qlsc.dto.CustomerDTO;
import com.sapo.qlsc.model.CustomerFilter;
import com.sapo.qlsc.model.SearchCustomer;
import com.sapo.qlsc.notification.MessageBox;
import com.sapo.qlsc.service.CustomerService;
import com.sapo.qlsc.service.MaintenanceCardService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.text.ParseException;
import java.util.List;
import java.util.Map;

@RestController
@CrossOrigin("http://localhost:3000")
@RequestMapping("/admin/")
public class CustomerController {

    private final CustomerService customerService;

    private final MaintenanceCardService maintenanceCardService;

    public CustomerController(CustomerService customerService, MaintenanceCardService maintenanceCardService) {
        this.customerService = customerService;
        this.maintenanceCardService = maintenanceCardService;
    }

    @PostMapping("/customers")
    public ResponseEntity<CustomerDTO> addCustomer(@RequestBody CustomerDTO customerDTO) throws ParseException {
        CustomerDTO customer = customerService.addCustomer(customerDTO);
        return new ResponseEntity<>(customer, HttpStatus.OK);
    }

    @GetMapping("/customers/{id}")
    public ResponseEntity<Object> getCustomerById(@PathVariable("id") Long idCustomer){
        CustomerDTO customerDTO = customerService.getById(idCustomer);
        return new ResponseEntity<>(customerDTO, HttpStatus.OK);
    }

    @GetMapping(path="/customers")
<<<<<<< HEAD
    public ResponseEntity<Object> searchCustomer(
            @RequestParam(name = "page", required = false, defaultValue = "1") Integer pageNumber,
            @RequestParam(name = "size", required = false, defaultValue = "5") Integer size,
            @RequestParam(name = "search", required = false, defaultValue = "") String search,
            @RequestParam(name = "nameField", required = false, defaultValue = "") String nameField,
            @RequestParam(name = "order", required = false, defaultValue = "") String order){
        Map<String,Object> allCustomer = customerService.searchCustomer(pageNumber,size, search, nameField, order);
=======
    public ResponseEntity<Object> searchCustomer(@ModelAttribute("searchCustomer")SearchCustomer searchCustomer){
        Map<String,Object> allCustomer = customerService.searchCustomer(searchCustomer);
>>>>>>> customer
        return new ResponseEntity<>(allCustomer, HttpStatus.OK);

    }

//    @GetMapping(path="/customers")
//    public ResponseEntity<Object> searchCustomer(SearchCustomer searchCustomer){
//        Map<String,Object> allCustomer = customerService.searchCustomer(searchCustomer.getPage(),searchCustomer.getSize(), searchCustomer.getSearch(), searchCustomer.getNameField(), searchCustomer.getOrder());
//        return new ResponseEntity<>(allCustomer, HttpStatus.OK);
//    }

    @GetMapping(path="/customers/filter")
    public ResponseEntity<Object> filterPayStatusOfCustomer(@ModelAttribute("customerFilter")CustomerFilter customerFilter){
        System.out.println(customerFilter);
        Map<String,Object> allCustomer = customerService.filterPayStatusOfCustomer(customerFilter);
        return new ResponseEntity<>(allCustomer, HttpStatus.OK);

    }

    @PutMapping(path = "/customers/{idCustomer}")
    public ResponseEntity<Object> updateCustomer(@RequestBody CustomerDTO customerDTO, @PathVariable("idCustomer") Long idCustomer){
        CustomerDTO customer = customerService.updateCustomer(customerDTO, idCustomer);
        return new ResponseEntity<>(customer, HttpStatus.OK);
    }

    @DeleteMapping(path = "/customers/{idCustomer}")
    public ResponseEntity<Object> deleteCustomer(@PathVariable("idCustomer") Long idCustomer){
        customerService.deleteCustomer(idCustomer);
        return new ResponseEntity<>(new MessageBox(true, "xóa thành công"), HttpStatus.OK);
    }

    @PostMapping(path = "/customers/updateStatus")
    public ResponseEntity<Object> updateMultipleStatusCustomer(
            @RequestParam(name = "ids", required = false, defaultValue = "") List<Long> ids){
        customerService.updateMultipleStatusCustomer(ids);
        return new ResponseEntity<>(new MessageBox(true, "Cập nhật trạng thái thành công"), HttpStatus.OK);
    }
}
